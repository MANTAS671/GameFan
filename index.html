<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Blackjack Pro</title>
    <style>
        /* Глобальные переменные и стили */
        :root {
            --bg-color: #1a3a1a;
            --table-color: #0d5c0d;
            --card-bg: #f8f8f8;
            --text-color: #ffffff;
            --button-bg: #d4af37;
            --button-hover-bg: #b89a2a;
            --button-disabled-bg: #777;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --accent-color: #ffdd57;
        }

        html {
            box-sizing: border-box;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            overflow: hidden; /* Предотвращение "дергания" на мобильных */
        }

        /* Основной контейнер игры */
        .game-container {
            background-color: var(--table-color);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            width: 100%;
            max-width: 900px;
            height: 95vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Область стола (карты) */
        .game-table {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
        }

        .hand-area {
            position: relative;
        }
        
        .hand-area h2 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .score {
            font-weight: bold;
            color: var(--accent-color);
        }

        .hand {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 105px;
            position: relative;
        }
        
        /* Стили для карт и анимаций */
        .card {
            background-color: var(--card-bg);
            width: 70px;
            height: 100px;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin: 0 -15px; /* Карты накладываются друг на друга */
            font-size: 1.8rem;
            font-weight: bold;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, margin 0.3s ease;
            transform-style: preserve-3d;
        }

        .hand:hover .card {
            margin: 0 5px; /* Разделение карт при наведении */
        }

        .card .front, .card .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .card .front {
            transform: rotateY(0deg);
        }
        
        .card .back {
            background: linear-gradient(135deg, #b30000, #660000);
            transform: rotateY(180deg);
        }

        .card.is-flipped {
            transform: rotateY(180deg);
        }
        
        .card-content {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
            width: 100%;
            padding: 5px;
        }
        .card-value { font-size: 1.2rem; }
        .card-suit { font-size: 1.5rem; }
        .top { align-self: flex-start; }
        .bottom { align-self: flex-end; transform: rotate(180deg); }

        .card.suit-♥, .card.suit-♦ { color: red; }
        .card.suit-♣, .card.suit-♠ { color: black; }

        /* Игровые сообщения */
        #message-area {
            min-height: 48px;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px 0;
        }

        /* Панель управления (кнопки и ставки) */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .betting-area, .actions-area {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        input[type="number"] {
            width: 100px;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid var(--button-bg);
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 1.1rem;
            text-align: center;
            -moz-appearance: textfield; /* Убрать стрелки в Firefox */
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        button {
            background-color: var(--button-bg);
            color: #000;
            border: none;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        button:hover:not(:disabled) {
            background-color: var(--button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        button:active:not(:disabled) {
            transform: translateY(0);
        }

        button:disabled {
            background-color: var(--button-disabled-bg);
            cursor: not-allowed;
        }

        /* Баланс и история */
        .game-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        #balance { font-weight: bold; color: var(--accent-color); }
        #history-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            text-decoration: underline;
            cursor: pointer;
        }
        
        .history-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            top: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }
        .history-panel.open {
            transform: translateY(0);
        }
        #history-content {
            flex-grow: 1;
            overflow-y: auto;
            text-align: left;
            font-size: 1rem;
        }
        #history-content p {
            margin: 5px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #444;
        }
        
        .player-hand-container {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .split-hand {
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 5px;
            transition: border-color 0.3s;
        }
        
        .split-hand.active-hand {
            border-color: var(--accent-color);
        }
        
        /* Адаптация для ПК */
        @media (min-width: 768px) {
            .game-container {
                flex-direction: row;
                height: auto;
            }
            .game-table {
                flex-basis: 70%;
            }
            .controls-and-info {
                flex-basis: 30%;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                padding-left: 20px;
            }
            .actions-area {
                flex-direction: column;
                align-items: stretch;
            }
            .hand:hover .card {
                margin: 0 2px;
            }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <!-- Левая часть (игровой стол) -->
        <div class="game-table">
            <!-- Рука дилера -->
            <div class="hand-area">
                <h2>Дилер (<span id="dealer-score" class="score">0</span>)</h2>
                <div id="dealer-hand" class="hand"></div>
            </div>

            <!-- Сообщение для игрока -->
            <div id="message-area">Сделайте вашу ставку</div>

            <!-- Рука игрока -->
            <div class="hand-area">
                 <h2>Вы (<span id="player-score" class="score">0</span>)</h2>
                 <div class="player-hand-container">
                    <div id="player-hand-1" class="split-hand"></div>
                    <div id="player-hand-2" class="split-hand"></div>
                 </div>
            </div>
        </div>

        <!-- Правая часть (управление и инфо - для ПК) -->
        <div class="controls-and-info">
            <div class="controls">
                <!-- Область ставок -->
                <div id="betting-area" class="betting-area">
                    <input type="number" id="bet-amount" value="10" min="1">
                    <button id="bet-button">Ставка</button>
                </div>
                <!-- Кнопки действий -->
                <div id="actions-area" class="actions-area" style="display: none;">
                    <button id="hit-button">Еще</button>
                    <button id="stand-button">Хватит</button>
                    <button id="double-button">Дабл</button>
                    <button id="split-button">Сплит</button>
                </div>
            </div>

            <!-- Баланс и история -->
            <div class="game-footer">
                <span>Баланс: <span id="balance">1000</span>$</span>
                <button id="history-toggle">История</button>
            </div>
        </div>
    </div>
    
    <!-- Панель истории -->
    <div id="history-panel" class="history-panel">
        <h2>История игр</h2>
        <div id="history-content"></div>
        <button id="close-history">Закрыть</button>
    </div>

    <script>
    // --- Игровой скрипт ---

    // 1. Инициализация переменных и DOM-элементов
    const suits = ['♥', '♦', '♣', '♠'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

    let deck = [];
    let playerHands = []; // Теперь это массив рук для поддержки сплита
    let dealerHand = [];
    let currentHandIndex = 0;
    let playerBalance = 1000;
    let currentBet = 0;
    let history = [];

    const dealerScoreEl = document.getElementById('dealer-score');
    const playerScoreEl = document.getElementById('player-score');
    const dealerHandEl = document.getElementById('dealer-hand');
    const playerHandContainer = document.querySelector('.player-hand-container');
    const messageEl = document.getElementById('message-area');
    const balanceEl = document.getElementById('balance');
    
    const bettingArea = document.getElementById('betting-area');
    const actionsArea = document.getElementById('actions-area');
    const betAmountInput = document.getElementById('bet-amount');
    const betButton = document.getElementById('bet-button');
    const hitButton = document.getElementById('hit-button');
    const standButton = document.getElementById('stand-button');
    const doubleButton = document.getElementById('double-button');
    const splitButton = document.getElementById('split-button');
    
    const historyPanel = document.getElementById('history-panel');
    const historyContent = document.getElementById('history-content');
    const historyToggle = document.getElementById('history-toggle');
    const closeHistoryBtn = document.getElementById('close-history');

    // 2. Основные функции игры

    function createDeck() {
        deck = [];
        for (let suit of suits) {
            for (let value of values) {
                deck.push({ suit, value });
            }
        }
        shuffleDeck();
    }

    function shuffleDeck() {
        for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
    }

    function getCardValue(card) {
        if (['K', 'Q', 'J'].includes(card.value)) return 10;
        if (card.value === 'A') return 11;
        return parseInt(card.value);
    }

    function getHandScore(hand) {
        let score = 0;
        let aceCount = 0;
        hand.forEach(card => {
            score += getCardValue(card);
            if (card.value === 'A') aceCount++;
        });
        while (score > 21 && aceCount > 0) {
            score -= 10;
            aceCount--;
        }
        return score;
    }

    function placeBet() {
        const betValue = parseInt(betAmountInput.value);
        if (betValue > 0 && betValue <= playerBalance) {
            currentBet = betValue;
            playerBalance -= currentBet;
            updateBalance();
            startGame();
        } else {
            messageEl.textContent = 'Недостаточно средств или неверная ставка!';
        }
    }
    
    function startGame() {
        if (deck.length < 15) createDeck(); // Пересоздаем колоду, если она заканчивается

        playerHands = [[dealCard(), dealCard()]];
        dealerHand = [dealCard(), dealCard()];
        currentHandIndex = 0;

        bettingArea.style.display = 'none';
        actionsArea.style.display = 'flex';
        
        messageEl.textContent = '';
        
        renderGame();

        if (getHandScore(playerHands[0]) === 21) {
            messageEl.textContent = 'Blackjack!';
            setTimeout(dealerTurn, 1000);
        }
    }

    function dealCard() {
        return deck.pop();
    }
    
    // 3. Функции действий игрока

    function hit() {
        let hand = playerHands[currentHandIndex];
        hand.push(dealCard());
        renderGame();
        
        if (getHandScore(hand) > 21) {
            messageEl.textContent = `Рука ${currentHandIndex + 1}: Перебор!`;
            if (currentHandIndex < playerHands.length - 1) {
                // Если есть еще рука после сплита
                setTimeout(() => {
                    currentHandIndex++;
                    renderGame();
                }, 1500);
            } else {
                // Если это была последняя рука
                setTimeout(dealerTurn, 1500);
            }
        }
    }

    function stand() {
         if (currentHandIndex < playerHands.length - 1) {
            currentHandIndex++;
            renderGame();
        } else {
            dealerTurn();
        }
    }

    function doubleDown() {
        if (playerBalance >= currentBet) {
            playerBalance -= currentBet;
            playerHands[currentHandIndex].bet *= 2;
            updateBalance();
            
            let hand = playerHands[currentHandIndex];
            hand.push(dealCard());
            renderGame();

            setTimeout(() => {
                if (getHandScore(hand) > 21) {
                    messageEl.textContent = `Рука ${currentHandIndex + 1}: Перебор!`;
                }
                if (currentHandIndex < playerHands.length - 1) {
                    currentHandIndex++;
                    renderGame();
                } else {
                    dealerTurn();
                }
            }, 1000);
        } else {
            messageEl.textContent = "Недостаточно средств для дабла!";
        }
    }

    function split() {
        if (playerBalance >= currentBet) {
            playerBalance -= currentBet;
            updateBalance();

            const hand = playerHands[currentHandIndex];
            playerHands.push([hand.pop()]);
            playerHands[currentHandIndex].push(dealCard());
            playerHands[1].push(dealCard());
            
            playerHands.forEach(h => h.bet = currentBet);

            renderGame();
        } else {
            messageEl.textContent = "Недостаточно средств для сплита!";
        }
    }

    // 4. Логика дилера и завершение игры

    function dealerTurn() {
        // Показываем скрытую карту дилера
        const hiddenCard = dealerHandEl.querySelector('.is-flipped');
        if(hiddenCard) hiddenCard.classList.remove('is-flipped');
        
        let dealerScore = getHandScore(dealerHand);
        dealerScoreEl.textContent = dealerScore;

        const dealerInterval = setInterval(() => {
            dealerScore = getHandScore(dealerHand);
            if (dealerScore < 17) {
                dealerHand.push(dealCard());
                renderGame(false); // Рендерим без обновления кнопок игрока
            } else {
                clearInterval(dealerInterval);
                endGame();
            }
        }, 1000);
    }
    
    function endGame() {
        const dealerScore = getHandScore(dealerHand);
        let roundWinnings = 0;
        let roundSummary = '';

        playerHands.forEach((hand, index) => {
            const playerScore = getHandScore(hand);
            const bet = hand.bet || currentBet;
            
            let resultText = `Рука ${index + 1}: `;
            if (playerScore > 21) {
                resultText += `Перебор. Проигрыш ${bet}$`;
                roundWinnings -= bet;
            } else if (dealerScore > 21 || playerScore > dealerScore) {
                if (playerScore === 21 && hand.length === 2) {
                    // Blackjack платит 3:2
                    const winAmount = Math.floor(bet * 1.5);
                    playerBalance += bet + winAmount;
                    roundWinnings += winAmount;
                    resultText += `Blackjack! Выигрыш ${winAmount}$`;
                } else {
                    playerBalance += bet * 2;
                    roundWinnings += bet;
                    resultText += `Выигрыш ${bet}$`;
                }
            } else if (playerScore < dealerScore) {
                resultText += `Проигрыш ${bet}$`;
                roundWinnings -= bet;
            } else {
                playerBalance += bet;
                resultText += `Ничья`;
            }
            roundSummary += (roundSummary ? '; ' : '') + resultText;
        });

        messageEl.textContent = roundSummary;
        updateBalance();
        updateHistory(roundSummary, roundWinnings);
        
        bettingArea.style.display = 'flex';
        actionsArea.style.display = 'none';
    }

    // 5. Функции рендеринга и UI

    function renderGame(updatePlayerControls = true) {
        renderDealerHand();
        renderPlayerHands();
        if (updatePlayerControls) updateActionButtons();
    }
    
    function renderCard(card, isFlipped = false) {
        const cardDiv = document.createElement('div');
        cardDiv.className = `card suit-${card.suit} ${isFlipped ? 'is-flipped' : ''}`;
        
        cardDiv.innerHTML = `
            <div class="back"></div>
            <div class="front">
                <div class="card-content">
                    <span class="top"><span class="card-value">${card.value}</span><span>${card.suit}</span></span>
                    <span class="card-suit">${card.suit}</span>
                    <span class="bottom"><span class="card-value">${card.value}</span><span>${card.suit}</span></span>
                </div>
            </div>`;
        return cardDiv;
    }

    function renderDealerHand() {
        dealerHandEl.innerHTML = '';
        const isPlayerTurn = actionsArea.style.display === 'flex';
        dealerHand.forEach((card, index) => {
            dealerHandEl.appendChild(renderCard(card, index === 0 && isPlayerTurn));
        });
        
        if (isPlayerTurn) {
            dealerScoreEl.textContent = getCardValue(dealerHand[1]);
        } else {
            dealerScoreEl.textContent = getHandScore(dealerHand);
        }
    }
    
    function renderPlayerHands() {
        ['player-hand-1', 'player-hand-2'].forEach((id, index) => {
            const handEl = document.getElementById(id);
            handEl.innerHTML = '';
            handEl.classList.remove('active-hand');
            if (playerHands[index]) {
                if (index === currentHandIndex) handEl.classList.add('active-hand');
                playerHands[index].forEach(card => handEl.appendChild(renderCard(card)));
            }
        });
        
        // Обновляем общий счетчик, если рука одна. Если рук несколько, счетчик можно убрать или усложнить.
        if (playerHands.length === 1) {
            playerScoreEl.textContent = getHandScore(playerHands[0]);
        } else {
            const scores = playerHands.map(h => getHandScore(h)).join(' / ');
            playerScoreEl.textContent = scores;
        }
    }
    
    function updateActionButtons() {
        const hand = playerHands[currentHandIndex];
        if (!hand) {
            hitButton.disabled = true;
            standButton.disabled = true;
            doubleButton.disabled = true;
            splitButton.disabled = true;
            return;
        }

        const score = getHandScore(hand);
        const isFirstTurn = hand.length === 2;

        hitButton.disabled = score >= 21;
        standButton.disabled = false;
        
        doubleButton.disabled = !isFirstTurn || playerBalance < (hand.bet || currentBet);
        
        const canSplit = isFirstTurn && getCardValue(hand[0]) === getCardValue(hand[1]) && playerBalance >= currentBet && playerHands.length < 2;
        splitButton.disabled = !canSplit;
    }
    
    function updateBalance() {
        balanceEl.textContent = `${playerBalance}$`;
    }

    function updateHistory(summary, result) {
        const resultClass = result > 0 ? 'win' : result < 0 ? 'loss' : 'push';
        const sign = result > 0 ? '+' : '';
        history.unshift(`<p class="${resultClass}">${summary} | Итог: ${sign}${result}$</p>`);
        if (history.length > 20) history.pop();
        historyContent.innerHTML = history.join('');
    }

    // 6. Обработчики событий
    betButton.addEventListener('click', placeBet);
    hitButton.addEventListener('click', hit);
    standButton.addEventListener('click', stand);
    doubleButton.addEventListener('click', doubleDown);
    splitButton.addEventListener('click', split);
    
    historyToggle.addEventListener('click', () => historyPanel.classList.add('open'));
    closeHistoryBtn.addEventListener('click', () => historyPanel.classList.remove('open'));

    // 7. Инициализация игры
    createDeck();
    updateBalance();
    
    </script>
</body>
</html>
